(self.webpackChunknakhlex=self.webpackChunknakhlex||[]).push([[9406],{59406:function(e,l,n){var t=n(95318);Object.defineProperty(l,"__esModule",{value:!0}),l.default=void 0;var a=t(n(87757)),r=t(n(67154)),u=function(e,l){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=y(l);if(n&&n.has(e))return n.get(e);var t={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var u=a?Object.getOwnPropertyDescriptor(e,r):null;u&&(u.get||u.set)?Object.defineProperty(t,r,u):t[r]=e[r]}return t.default=e,n&&n.set(e,t),t}(n(67294)),i=n(785),o=n(39698),m=n(59693),c=n(34787),d=n(50599),s=n(51222),f=n(4070),_=n(46823),b=n(30657),N=n(9033),p=this,v="/Users/phinix/Workspace/BitBayt/src/features/Settings/screens/Profile.tsx";function y(e){if("function"!=typeof WeakMap)return null;var l=new WeakMap,n=new WeakMap;return(y=function(e){return e?n:l})(e)}l.default=function(e){var l=e.navigation,n=(0,s.useProfileApi)(),t=n.data,y=n.isFetching,g=(0,s.useUpdateProfileApi)(),h=g.mutate,E=g.isLoading;(0,u.useEffect)((function(){null!=t&&t.kycLevel&&(0,N.setUserMutation)({id:+((null==t?void 0:t.id)||"0"),kycLevel:null==t?void 0:t.kycLevel,phone:(null==t?void 0:t.phone)||""})}),[null==t?void 0:t.kycLevel]);var k=(0,c.useIsLoading)(y,E),x=(0,u.useMemo)((function(){return"waiting"===(null==t?void 0:t.kycStatus)}),[null==t?void 0:t.kycStatus]),C=(0,_.createSchema)({phone:_.mobileSchema.test("Verify",(0,o.$t)("mobileVerification"),(function(){var e;return(null==t||null==(e=t.phone)?void 0:e.replace("+964","0"))===L("phone")})),email:_.emailSchema,name:(0,_.requiredStringSchema)((0,o.$t)("name")),surname:(0,_.requiredStringSchema)((0,o.$t)("surname")),nationalId:(0,_.requiredStringSchema)((0,o.$t)("nationId")),idCard:(0,_.requiredMixSchema)((0,o.$t)("idCard")),userName:(0,_.requiredStringSchema)((0,o.$t)("username"))}),w=(0,c.useCustomForm)(C),S=w.control,P=w.reset,I=w.handleSubmit,V=w.setValue,L=w.getValues,$=w.formState,M=$.isValid,j=$.isDirty;(0,u.useEffect)((function(){var e;t&&P((0,r.default)({},t,{phone:null==t||null==(e=t.phone)?void 0:e.replace("+964","0")}))}),[t,P]);var O=function(e){var l,n=e.phone,u=e.email,i=e.userName,c=e.name,d=e.surname,s=e.nationalId,_=e.idCard,b={};i!==(null==t?void 0:t.userName)&&(b=(0,r.default)({userName:i},b)),u!==(null==t?void 0:t.email)&&(b=(0,r.default)({email:u},b)),n&&n!==(null==t||null==(l=t.phone)?void 0:l.replace("+964","0"))&&(b=(0,r.default)({phone:n.replace("0","+964")},b)),null!=t&&t.kycLevel||(c!==(null==t?void 0:t.name)&&(b=(0,r.default)({name:c},b)),d!==(null==t?void 0:t.surname)&&(b=(0,r.default)({surname:d},b)),s!==(null==t?void 0:t.nationalId)&&(b=(0,r.default)({nationalId:s},b)),_!==(null==t?void 0:t.idCard)&&(b=(0,r.default)({idCard:_},b))),h(b,{onSuccess:function(e){return a.default.async((function(l){for(;;)switch(l.prev=l.next){case 0:e.ok?((0,m.showPopupMessage)((0,o.$t)("successful"),"success"),f.queryClient.invalidateQueries("profile"),(0,o.trackEvent)("Profile_Updated")):(0,m.extractFetchError)(e);case 1:case"end":return l.stop()}}),null,null,null,Promise)}})};return u.default.createElement(m.Screen,{__self:p,__source:{fileName:v,lineNumber:135,columnNumber:5}},u.default.createElement(d.KeyboardAvoiding,{extraHeight:80,__self:p,__source:{fileName:v,lineNumber:136,columnNumber:7}},u.default.createElement(i.ScrollView,{__self:p,__source:{fileName:v,lineNumber:137,columnNumber:9}},"reject"===(null==t?void 0:t.kycStatus)&&t.kycComment&&u.default.createElement(m.Text,{variant:"body",color:"red",textAlign:"center",marginTop:"m",__self:p,__source:{fileName:v,lineNumber:139,columnNumber:13}},null==t?void 0:t.kycComment),"waiting"===(null==t?void 0:t.kycStatus)&&u.default.createElement(m.Text,{variant:"body",textAlign:"center",marginTop:"m",__self:p,__source:{fileName:v,lineNumber:145,columnNumber:13}},(0,o.$t)("waitForKYC")),u.default.createElement(m.View,{flexDirection:"row",justifyContent:"space-around",paddingTop:"m",__self:p,__source:{fileName:v,lineNumber:150,columnNumber:11}},u.default.createElement(m.View,{flex:1,paddingHorizontal:"s",__self:p,__source:{fileName:v,lineNumber:154,columnNumber:13}},u.default.createElement(m.Input,{disabled:x||!(null==t||!t.kycLevel),name:"name",textContentType:"name",control:S,label:(0,o.$t)("name"),__self:p,__source:{fileName:v,lineNumber:155,columnNumber:15}})),u.default.createElement(m.View,{flex:1,paddingHorizontal:"s",__self:p,__source:{fileName:v,lineNumber:164,columnNumber:13}},u.default.createElement(m.Input,{disabled:x||!(null==t||!t.kycLevel),name:"surname",textContentType:"familyName",control:S,label:(0,o.$t)("surname"),__self:p,__source:{fileName:v,lineNumber:165,columnNumber:15}}))),u.default.createElement(m.View,{flexDirection:"row",justifyContent:"space-around",__self:p,__source:{fileName:v,lineNumber:175,columnNumber:11}},u.default.createElement(m.View,{flex:1,paddingHorizontal:"s",__self:p,__source:{fileName:v,lineNumber:176,columnNumber:13}},u.default.createElement(m.Input,{disabled:x||!(null==t||!t.kycLevel),name:"nationalId",maxLength:12,keyboardType:"numeric",control:S,label:(0,o.$t)("nationId"),__self:p,__source:{fileName:v,lineNumber:177,columnNumber:15}})),u.default.createElement(m.Pressable,{flex:1,paddingHorizontal:"s",onPress:function(){null!=t&&t.idCard&&l.navigate("ImageViewer",{uri:null==t?void 0:t.idCard})},__self:p,__source:{fileName:v,lineNumber:187,columnNumber:13}},u.default.createElement(b.ProfileIdCard,{name:"idCard",control:S,disabled:x||!(null==t||!t.kycLevel),setValue:V,idCard:null==t?void 0:t.idCard,__self:p,__source:{fileName:v,lineNumber:195,columnNumber:15}}))),u.default.createElement(m.View,{flex:1,paddingHorizontal:"s",__self:p,__source:{fileName:v,lineNumber:205,columnNumber:11}},u.default.createElement(m.Input,{name:"userName",textContentType:"username",control:S,disabled:x,label:(0,o.$t)("username"),Append:u.default.createElement(m.Icon,{name:"person-outline",__self:p,__source:{fileName:v,lineNumber:212,columnNumber:23}}),__self:p,__source:{fileName:v,lineNumber:206,columnNumber:13}})),u.default.createElement(m.View,{flex:1,paddingHorizontal:"s",__self:p,__source:{fileName:v,lineNumber:216,columnNumber:11}},u.default.createElement(d.EmailInput,{name:"email",control:S,disabled:x,__self:p,__source:{fileName:v,lineNumber:217,columnNumber:13}})),u.default.createElement(m.View,{flex:1,paddingHorizontal:"s",__self:p,__source:{fileName:v,lineNumber:241,columnNumber:11}},L("phone")&&u.default.createElement(o.OTPMobile,{phone:L("phone"),target:"updateProfile",payload:(0,r.default)({},L()),toggle:function(e){var l=e.sendCode,n=e.isLoading;return u.default.createElement(d.MobileInput,{name:"phone",control:S,disabled:x,isLoading:n,sendCode:function(){return l(L("phone"))},__self:p,__source:{fileName:v,lineNumber:248,columnNumber:19}})},onConfirm:function(e){e&&O({phone:L("phone")})},__self:p,__source:{fileName:v,lineNumber:243,columnNumber:15}})),!x&&u.default.createElement(m.View,{flex:1,paddingHorizontal:"s",__self:p,__source:{fileName:v,lineNumber:266,columnNumber:13}},u.default.createElement(m.Button,{label:(0,o.$t)("save"),loading:k,onPress:I(O),disabled:!M||!j,__self:p,__source:{fileName:v,lineNumber:267,columnNumber:15}})))))}}}]);